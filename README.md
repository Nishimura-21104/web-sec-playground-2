# web-sec-playground-2
実装課題2
プロジェクト概要
このプロジェクトは、Next.jsとExpressを組み合わせたセキュアな認証システムの実装例です。ユーザー登録、ログイン、セッション管理、そして保護されたルートへのアクセスといった基本的な認証フローを、セキュリティとユーザーエクスペリエンスを考慮して構築しました。

主な機能

セキュアなユーザー認証: 
パスワードには業界標準のbcryptjsライブラリを使用し、安全にハッシュ化して保存します。

リアルタイムなパスワード強度チェック: 
サインアップ時にパスワードの強度を視覚的にフィードバックすることで、ユーザーに強力なパスワード設定を促します。
![サインアップ画面のスクリーンショット](./images/signup.png)

ログイン後のリダイレクト:
ログインに成功すると、サーバーは保護されたルートである/dashboardへ自動的にリダイレクトします。これにより、ユーザーはスムーズにアプリケーションのメインページに移行できます。
![ログイン後の画面のスクリーンショット](./images/dashboard.png)

データベースによるセッション管理: 
express-sessionとconnect-session-knexを組み合わせ、セッション情報をデータベース（SQLite）に永続化させます。これにより、サーバー再起動後もセッションが維持されます。

セキュアなHTTPヘッダー設定: 
コンテンツセキュリティポリシー（CSP）やX-Frame-Optionsなどを設定し、クリックジャッキングやXSS攻撃といった一般的なウェブ攻撃に対する防御を強化しています。

技術スタック

フロントエンド: Next.js

バックエンド: Express.js

データベース: SQLite

認証・認可:

express-session

connect-session-knex

bcryptjs

データベース操作: knex

その他: zxcvbn（パスワード強度チェック）

力を入れた点

パスワード強度チェックの導入
ユーザー登録画面でzxcvbnライブラリを使用し、パスワードの入力をリアルタイムで分析。強度レベルをプログレスバーとテキストで表示することで、ユーザーが安全なパスワードを直感的に理解できるようにしました。
![サインアップ画面のスクリーンショット](./images/passwordcheck.png)

サインアップのときに確認用パスワードを要求するようなUI機能
サインアップフォームに「パスワード」と「確認用パスワード」の2つのフィールドを設け、JavaScriptでリアルタイムに両者の値が一致するかを検証します。これにより、ユーザーが意図しないパスワードで登録してしまうミスを未然に防ぎ、登録時の成功率を高める工夫をしています。

強固なデータベース初期化処理
開発中に発生したデータベーススキーマの不一致エラー（SQLITE_ERROR: no such column: expired）を解決するため、server.jsにasync/awaitを使った同期的なセットアップ関数を導入しました。この関数は、サーバー起動時に既存のsessionsテーブルを一度削除し、正しいスキーマで再作成することで、安定した開発環境を保証します。

厳格なセッションクッキー設定
セッションクッキーにhttpOnly: true, secure: !dev, sameSite: 'strict'といったセキュリティ設定を適用しました。これにより、クロスサイトスクリプティング（XSS）攻撃からの保護や、安全な通信チャネルの利用を強制し、セッション情報の漏洩リスクを最小限に抑えています。
